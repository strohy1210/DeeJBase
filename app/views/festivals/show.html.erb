  <script type="text/javascript">
    $(function() {  
        $('#select_origin').autocomplete({
            source: '<%= djs_path(:json) %>'
          })

        $('.submit-comment').click(function(){
          var dj_name = $('#select_origin').val();
          $('#link_dj').val(dj_name);
        })
        
    })

    </script>

<div class= "venue-show container-fluid">
<div class="row page-header title">
  <h2 class='col-md-5'> <%= @festival.name %>  </h2>

</div>
<div class="dj-profile">

<div class="row">
<div id="dj-profile">
  <div class="dj-info promoter-info col-md-6 vertical-center">   
    <div class="other-info">
      <h4>Review <%=@festival.name%>'s music.</h4>
      DJB Rating<sup></sup>:
      <div id='star'>
   
      </div>
    </div>
  
  <div class='rate-button btn-centered btn btn-default'>Review <%=@festival.name%></div>

  <div class="rate-dj text-center">
    <% if logged_in? %>

      <p><strong>What'd you think of <%= @festival.name %>'s DJ?</strong><br>


      <div class="user-rate">
        <div id='user_star'>

        </div></p>

        <%= simple_form_for(@comment, url: comment_path(@comment), method: "patch") do |f| %>
      
          <%= f.input :body, label: "Rate above. Comment (at least 1-2 sentences) below.", required: false, hint: " ", placeholder: "How did the DJ do? Transitions, song choice? - we don't want to hear how long you waited in line or how shitty the bartender was (min 40 characters).", input_html: { minlength: 40, rows: 10,  class: "form-control comment" }%>
          <div class="row">
            <div class="date-select col-md-6">
            <%= label_tag :event_date %><br>
            <%= text_field_tag :date, "mm-dd-yyyy", {class: "text-center datepicker"} %>
            <%= hidden_field_tag :festival_id, @festival.id %>
             <%= hidden_field_tag :rating_id, @new_rating.id %>
            </div>
              <div class='col-md-5 dj-autocomplete'>
              DJ (optional)<br>
               <input id="select_origin" class="form-control" placeholder="Dj's Soundcloud name here"/>
            <input id="link_dj" name="dj_name" type="hidden"/>
          </div>
        </div><br>
          <%= f.button :submit, "Submit Comment", class: "disabled btn btn-default submit-comment"%>

        <%end%>
        <a href="#"><div class="done-rating cancel-comment" title="To delete your comment, cancel your rating or text body and hit 'update comment' above."style="color: red;">Cancel</div></a>
      </div>
    <%elsif !logged_in?%>
      <div class="text-center bg-warning">
      <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span><strong> You must be logged in to add a rating.</strong>

      
      <h4><%= link_to 'Sign in with Facebook', '/auth/facebook'%>
      | <%= link_to 'Back', '#', class: 'text-center done-rating'%></h4>   </div>
     <%end%> 
 
  </div><br>
</div>

</div>
</div>
<br>
<br>
  <% if @comments %>
     <h5 class="row venue-comments-title">Reviews</h5>

     <%= render 'reviews' %>

  <%end%>
</div>

  <% content_for :head do %>
    <meta property="fb:app_id" content="373382026154995" />
    <meta property="og:url" content="http://www.deejbase.com/festivals/<%=@festival.slugify%>" /> 
    <meta property="og:site_name" content="Deejbase" />
    <%if @rating_fbshare %>
      <meta property="og:title" content="I rated <%=@festival.name%> <%=@rating_fbshare%> out of 5 stars. Check out my review." />
    <%else%>
      <meta property="og:title" content="I reviewed the music at <%=@festival.name%>. Check it out." />
    <%end%>
    <meta property="og:description" content="<%=@comment_fbshare%>"/>
    <meta property="og:image" content="<%=@festival.image_url%>" /> 
  <% end %>

  <% if logged_in? && @festival.ratings.where(user: current_user).valid_only.any?%><br>
  <div class="social-share">
    Share your most recent review
    <div class="fb-share-button" data-href="http://www.deejbase.com/festivals/<%=@festival.slugify%>" data-layout="button"></div></div>
  <%end%>

<br>

<script>
  $('#star').raty({
    readOnly: true,
    score: <%= @festival.average_rating %>,
    path: '/assets'
  });


  $('#user_star').raty({
    score: <%= @new_rating.score %>,
    cancel: true,
    path: '/assets',
    click: function(score, evt) {
      $.ajax({
        url: '/ratings/' + <%= @new_rating.id %>,
        type: 'PATCH',
        data: { score: score }
      });
    }
  });



</script>